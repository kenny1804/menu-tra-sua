<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Trà Sữa - Quét QR</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#f68e57',
                        'secondary': '#a78bfa',
                        'dark-bg': '#1f2937',
                        'dark-text': '#f3f4f6',
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .cart-icon {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-bg text-gray-900 dark:text-dark-text">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-primary dark:text-orange-400">Trà Sữa Của Bạn</h1>
            <p class="text-xl mt-2 text-gray-600 dark:text-gray-400">Thực đơn đồ uống - Quét mã QR để đặt hàng</p>
        </header>

        <!-- Menu Sections -->
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Menu items will be injected here by JavaScript -->
        </div>

        <!-- Floating Cart Button -->
        <button id="cart-button" class="cart-icon bg-primary text-white p-4 rounded-full shadow-lg hover:bg-orange-600 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.706.707 1.706H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span id="cart-count" class="ml-1 text-sm font-semibold">0</span>
        </button>

        <!-- Cart Modal -->
        <div id="cart-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white dark:bg-dark-bg rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h2 class="text-2xl font-semibold">Giỏ Hàng</h2>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-900">&times;</button>
                </div>
                <div id="cart-items" class="max-h-80 overflow-y-auto mb-4">
                    <!-- Cart items will be injected here -->
                    <p id="empty-cart-message" class="text-gray-500">Giỏ hàng của bạn đang trống.</p>
                </div>
                <div class="text-right font-bold text-xl mb-4">
                    Tổng cộng: <span id="total-price">0đ</span>
                </div>
                <button id="place-order-button" class="w-full bg-secondary text-white py-3 rounded-md font-bold hover:bg-purple-700 transition-colors">
                    Đặt Hàng
                </button>
                <p id="order-message" class="text-center mt-4 hidden text-green-600"></p>
            </div>
        </div>
    </div>

    <script>
        // Data for the bubble tea menu
        const menu = {
            'Trà Sữa': [
                { name: 'Trà Sữa Truyền Thống', price: 25000, img: 'https://placehold.co/150x150/f9a8d4/ffffff?text=TS+Truyền+Thống' },
                { name: 'Trà Sữa Thái', price: 28000, img: 'https://placehold.co/150x150/fcd34d/ffffff?text=TS+Thái' },
                { name: 'Trà Sữa Khoai Môn', price: 30000, img: 'https://placehold.co/150x150/a78bfa/ffffff?text=TS+Khoai+Môn' },
                { name: 'Trà Sữa Caramel', price: 32000, img: 'https://placehold.co/150x150/fbbf24/ffffff?text=TS+Caramel' },
            ],
            'Trà Trái Cây': [
                { name: 'Trà Đào Cam Sả', price: 35000, img: 'https://placehold.co/150x150/fdba74/ffffff?text=Trà+Đào' },
                { name: 'Trà Vải', price: 30000, img: 'https://placehold.co/150x150/f87171/ffffff?text=Trà+Vải' },
                { name: 'Trà Dâu', price: 32000, img: 'https://placehold.co/150x150/fca5a5/ffffff?text=Trà+Dâu' },
                { name: 'Trà Xoài', price: 35000, img: 'https://placehold.co/150x150/fde68a/ffffff?text=Trà+Xoài' },
            ],
            'Toppings': [
                { name: 'Trân Châu Đen', price: 5000, img: 'https://placehold.co/150x150/4b5563/ffffff?text=TCD' },
                { name: 'Trân Châu Trắng', price: 6000, img: 'https://placehold.co/150x150/e5e7eb/1f2937?text=TCT' },
                { name: 'Thạch Rau Câu', price: 5000, img: 'https://placehold.co/150x150/d1d5db/1f2937?text=Thạch' },
                { name: 'Kem Phô Mai', price: 10000, img: 'https://placehold.co/150x150/fcd34d/1f2937?text=Kem+Phô+Mai' },
            ]
        };

        const menuContainer = document.getElementById('menu-container');
        const cartButton = document.getElementById('cart-button');
        const cartCountSpan = document.getElementById('cart-count');
        const cartModal = document.getElementById('cart-modal');
        const closeModalButton = document.getElementById('close-modal');
        const cartItemsContainer = document.getElementById('cart-items');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const totalPriceSpan = document.getElementById('total-price');
        const placeOrderButton = document.getElementById('place-order-button');
        const orderMessage = document.getElementById('order-message');

        let cart = JSON.parse(localStorage.getItem('bubbleTeaCart')) || [];

        // Function to render the menu
        function renderMenu() {
            menuContainer.innerHTML = ''; // Clear existing menu
            for (const category in menu) {
                // Create category title
                const categorySection = document.createElement('div');
                categorySection.className = 'col-span-1 md:col-span-2 lg:col-span-3 mb-4';
                categorySection.innerHTML = `<h2 class="text-3xl font-bold border-b-2 border-primary pb-2 text-gray-800 dark:text-gray-300">${category}</h2>`;
                menuContainer.appendChild(categorySection);

                // Create items for the category
                menu[category].forEach(item => {
                    const itemCard = document.createElement('div');
                    itemCard.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 flex items-center space-x-4 transition-transform transform hover:scale-105 hover:shadow-xl';
                    itemCard.innerHTML = `
                        <img src="${item.img}" alt="${item.name}" class="w-16 h-16 rounded-full object-cover">
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold">${item.name}</h3>
                            <p class="text-primary font-bold mt-1">${item.price.toLocaleString('vi-VN')}đ</p>
                        </div>
                        <button class="add-to-cart-btn bg-secondary text-white p-2 rounded-full hover:bg-purple-700 transition-colors text-sm">
                            Thêm
                        </button>
                    `;
                    itemCard.querySelector('.add-to-cart-btn').addEventListener('click', () => addToCart(item));
                    menuContainer.appendChild(itemCard);
                });
            }
        }

        // Function to add item to cart
        function addToCart(item) {
            const existingItem = cart.find(cartItem => cartItem.name === item.name);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...item, quantity: 1 });
            }
            localStorage.setItem('bubbleTeaCart', JSON.stringify(cart));
            updateCart();
            showOrderMessage(`Đã thêm ${item.name} vào giỏ hàng!`);
        }

        // Function to update cart display
        function updateCart() {
            cartCountSpan.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
            renderCartItems();
        }

        // Function to render cart items in modal
        function renderCartItems() {
            cartItemsContainer.innerHTML = ''; // Clear existing items
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                placeOrderButton.disabled = true;
                placeOrderButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                emptyCartMessage.style.display = 'none';
                placeOrderButton.disabled = false;
                placeOrderButton.classList.remove('opacity-50', 'cursor-not-allowed');
                let total = 0;
                cart.forEach((item, index) => {
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    cartItemEl.innerHTML = `
                        <div>
                            <span class="font-semibold">${item.name}</span>
                            <span class="text-gray-500"> x${item.quantity}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="font-bold">${(item.price * item.quantity).toLocaleString('vi-VN')}đ</span>
                            <button class="remove-from-cart-btn text-red-500 text-xl font-bold">&times;</button>
                        </div>
                    `;
                    cartItemEl.querySelector('.remove-from-cart-btn').addEventListener('click', () => removeFromCart(index));
                    cartItemsContainer.appendChild(cartItemEl);
                    total += item.price * item.quantity;
                });
                totalPriceSpan.textContent = `${total.toLocaleString('vi-VN')}đ`;
            }
        }

        // Function to remove item from cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('bubbleTeaCart', JSON.stringify(cart));
            updateCart();
        }

        // Function to show order message
        function showOrderMessage(message) {
            orderMessage.textContent = message;
            orderMessage.classList.remove('hidden', 'text-green-600', 'text-red-600');
            orderMessage.classList.add('text-green-600');
            setTimeout(() => {
                orderMessage.classList.add('hidden');
            }, 3000);
        }

        // Event listeners
        cartButton.addEventListener('click', () => {
            cartModal.classList.remove('hidden');
            renderCartItems();
        });

        closeModalButton.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });

        window.addEventListener('click', (event) => {
            if (event.target === cartModal) {
                cartModal.classList.add('hidden');
            }
        });

        placeOrderButton.addEventListener('click', () => {
            if (cart.length === 0) {
                showOrderMessage("Giỏ hàng trống!");
                return;
            }

            const orderDetails = cart.map(item => `${item.name} (x${item.quantity}) - ${(item.price * item.quantity).toLocaleString('vi-VN')}đ`).join('\n');
            const finalOrderText = `Đơn Hàng:\n${orderDetails}\nTổng Cộng: ${totalPriceSpan.textContent}`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(finalOrderText).then(() => {
                    showOrderMessage("Đã sao chép đơn hàng vào clipboard!");
                    cart = [];
                    localStorage.removeItem('bubbleTeaCart');
                    updateCart();
                    cartModal.classList.add('hidden');
                }).catch(err => {
                    console.error('Không thể sao chép văn bản: ', err);
                    showOrderMessage("Lỗi: Không thể sao chép đơn hàng.");
                });
            } else {
                // Fallback for browsers that don't support navigator.clipboard
                const textarea = document.createElement('textarea');
                textarea.value = finalOrderText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showOrderMessage("Đã sao chép đơn hàng vào clipboard!");
                    cart = [];
                    localStorage.removeItem('bubbleTeaCart');
                    updateCart();
                    cartModal.classList.add('hidden');
                } catch (err) {
                    console.error('Không thể sao chép văn bản: ', err);
                    showOrderMessage("Lỗi: Không thể sao chép đơn hàng.");
                }
                document.body.removeChild(textarea);
            }
        });

        // Initial render
        renderMenu();
        updateCart();
    </script>
</body>
</html>
